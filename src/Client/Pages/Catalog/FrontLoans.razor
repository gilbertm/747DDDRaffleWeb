@page "/catalog/front/loans"
@using System.Globalization
@using EHULOG.BlazorWebAssembly.Client.Components.EntityContainer
@attribute [MustHavePermission(EHULOGAction.View, EHULOGResource.Loans)]

@inject IStringLocalizer<FrontLoans> L

<EhulogTitle Title="@L["Loans"]" Description="@L["Browse"]" />

@if (_appUserDto is not null)
{
    <EntityContainer TEntity="LoanDto" Context="@Context"></EntityContainer>
}

@code {
    protected RenderFragment<LoanDto> BodyTemplate => trail => __builder =>
    {
        <MudCard>

            <MudCardContent>
                @{
                    Console.WriteLine(System.Text.Json.JsonSerializer.Serialize(trail));
                }

                @{
                    Console.WriteLine(System.Text.Json.JsonSerializer.Serialize(trail.LoanLenders?.FirstOrDefault()?.Product?.Name));
                }

                <div class="thumbnail clearfix">
                    <img src="https://picsum.photos/400/250" alt="" />
                    <div class="caption" id="@trail.Id">
                        <MudText Typo="Typo.h5">@trail.LoanLenders?.FirstOrDefault()?.Product?.Name</MudText>

                        <MudText Typo="Typo.body1" Class="caption-text">
                            @trail.LoanLenders?.FirstOrDefault()?.Product?.Description
                        </MudText>

                        <MudElement HtmlTag="div" Class="price-buy-spacing">
                            <MudText Class="lead">@trail.Month</MudText>
                            <MudElement HtmlTag="div"><a class="btn btn-success" href="/loan/@trail.Id">Add to cart</a></MudElement>
                        </MudElement>
                        @if (_appUserDto is not null)
                        {
                            if (trail.LoanLenders is not null)
                            {
                                var loanLender = trail.LoanLenders.FirstOrDefault();

                                if (loanLender is not null && loanLender.LenderId.Equals(_appUserDto.Id))
                                {
                                    <MudElement HtmlTag="div" Class="price-buy-spacing">
                                        THIS IS MINE
                                    </MudElement>
                                }
                            }
                        }


                    </div>
                </div>
            </MudCardContent>
        </MudCard>
    };
}