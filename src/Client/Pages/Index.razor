@page "/home"
@page "/"
@using Nager.Country;
@using EHULOG.BlazorWebAssembly.Client.Pages.Catalog.Anons;

@attribute [AllowAnonymous]

@if (AppDataService != default)
{
    @if (!_isAuthenticated)
    {
        <FrontAnonLoans />

    }
}

<LossGeolocationPopup />

@code {

    [CascadingParameter(Name = "AppDataService")]
    protected AppDataService AppDataService { get; set; } = default!;

    private bool _isAuthenticated = default!;

    protected override async Task OnInitializedAsync()
    {
        if (AppDataService != default)
        {
            if ((await AppDataService.IsAuthenticated()) == default)
            {
                _isAuthenticated = false;
            }
            else
            {
                await AppDataService.InitializationAsync();

                if (AppDataService.AppUser != default)
                {
                    if (!string.IsNullOrEmpty(AppDataService.AppUser.RoleName) && AppDataService.AppUser.RoleName.Equals("Lender"))
                    {
                        Navigation.NavigateTo("/loans/lender");
                    }
                    else
                    {
                        if (AppDataService.AppUser.RolePackageStatus != default)
                        {
                            if (AppDataService.AppUser.RolePackageStatus < VerificationStatus.Submitted)
                            {
                                Navigation.NavigateTo("/account/role-subscription");
                            }
                            else
                            {
                                Navigation.NavigateTo("/loans/lessee");
                            }
                        }
                    }
                }

            }

        }   
    }
}