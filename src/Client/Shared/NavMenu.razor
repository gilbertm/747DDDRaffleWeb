@inject IStringLocalizer<NavMenu> L

<PersonCard Style="background-color: var(--custom-appbar-secondary-menu);color: var(--mud-palette-white); margin-bottom:0px!important" />

@if (AppDataService != default && AppDataService.AppUser != default)
{
    <MudNavMenu>

        @* Personal *@
        <MudNavLink Href="/" Match="NavLinkMatch.All" Icon="@Icons.Material.Filled.Home">@L["Home"] (@AppDataService.AppUser.RoleName)</MudNavLink>

        @if (_canViewDashboard)
        {
            <MudNavLink Href="/dashboard" Match="NavLinkMatch.All" Icon="@Icons.TwoTone.Dashboard">@L["Dashboard"]</MudNavLink>
        }

        @* Management *@
        @if (CanViewAdministrationGroup)
        {
            @if (_canViewUsers)
            {
                <MudNavGroup Title="@L["Users"]" Expanded Icon="@Icons.TwoTone.VerifiedUser" ExpandIcon="@Icons.Filled.KeyboardArrowDown">
                    <MudNavLink Match="NavLinkMatch.All" Href="/users" Icon="@Icons.Material.Filled.PeopleAlt" Class="custom-nav-child">@L["Users"]</MudNavLink>

                    @if (_canViewInputOutputResources)
                    {
                        <MudNavLink Match="NavLinkMatch.All" Href="/admin/user/identification-files-documents" Icon="@Icons.Material.Filled.FilePresent" Class="custom-nav-child">@L["Files"]</MudNavLink>
                    }
                </MudNavGroup>
            }
            <MudNavGroup Title="@L["Manage"]" Expanded Icon="@Icons.TwoTone.Settings" ExpandIcon="@Icons.Filled.KeyboardArrowDown">
                @if (_canViewRoles)
                {
                    <MudNavLink Href="/roles" Icon="@Icons.Material.Filled.EmojiPeople">@L["Roles"]</MudNavLink>
                }
                @if (_canViewTenants)
                {
                    <MudNavLink Href="/tenants" Icon="@Icons.TwoTone.GroupWork" Disabled="!_canViewTenants">@L["Tenants"]</MudNavLink>
                }

                <MudNavLink Href="/audit-logs" Icon="@Icons.Material.Filled.SecurityUpdateGood">@L["Logs"]</MudNavLink>
            </MudNavGroup>
        }

        @* normal users *@
        @if (!CanViewAdministrationGroup)
        {
            <MudNavGroup Title="@L["Account"]" Expanded="@(_isVerified ? false : true)" Icon="@(_isVerified ? RaffleIcon.VerifiedUser : Icons.TwoTone.PersonOutline)" IconColor="@(_isVerified ? Color.Success : default)" ExpandIcon="@Icons.Filled.KeyboardArrowDown">
                <MudNavLink Match="NavLinkMatch.All" Href="/account" Icon="@Icons.TwoTone.AssignmentInd" Class="custom-nav-child">@L["Profile"]</MudNavLink>
                <MudNavLink Match="NavLinkMatch.All" Href="/account/address" ForceLoad="true" Icon="@Icons.TwoTone.Map" Class="custom-nav-child">
                    @L["Address"]

                    @switch (AppDataService.AppUser.AddressStatus)
                    {
                        case VerificationStatus.Initial:
                            <MudIcon Icon="@Icons.Outlined.WarningAmber" Color="Color.Error" Size="Size.Small" Class="mx-2" Title="Action required" />
                            break;
                        case VerificationStatus.Submitted:
                            <MudIcon Icon="@Icons.Outlined.FactCheck" Color="Color.Surface" Size="Size.Small" Class="mx-2" Title="Under review" />
                            break;
                        case VerificationStatus.Verified:
                            @if (!_isVerified)
                            {
                                <MudIcon Icon="@Icons.Outlined.CheckCircle" Style="@($"color:{Colors.Green.Lighten3}")" Size="Size.Small" Class="mx-2" Title="Verified" />
                            }
                            break;
                    }
                </MudNavLink>
                <MudNavLink Match="NavLinkMatch.All" Href="/account/role-subscription" ForceLoad="true" Icon="@RaffleIcon.PaymentMethod" Class="custom-nav-child">
                    @L["Subscription"]

                    @switch (AppDataService.AppUser.RolePackageStatus)
                    {
                        case VerificationStatus.Initial:
                            <MudIcon Icon="@Icons.Outlined.WarningAmber" Color="Color.Error" Size="Size.Small" Class="mx-2" Title="Action required" />
                            break;
                        case VerificationStatus.Submitted:
                            <MudIcon Icon="@Icons.Outlined.WatchLater" Color="Color.Surface" Size="Size.Small" Class="mx-2" Title="Payment or necessary further needed" />
                            break;
                        case VerificationStatus.Verified:
                            @if (!_isVerified)
                            {
                                <MudIcon Icon="@Icons.Outlined.CheckCircle" Style="@($"color:{Colors.Green.Lighten3}")" Size="Size.Small" Class="mx-2" Title="Verified" />
                            }
                            break;
                    }
                </MudNavLink>
                <MudNavLink Match="NavLinkMatch.All" Href="/account/document" ForceLoad="true" Icon="@RaffleIcon.Document" Class="custom-nav-child">
                    @L["Documents"]

                    @switch (AppDataService.AppUser.DocumentsStatus)
                    {
                        case VerificationStatus.Initial:
                            <MudIcon Icon="@Icons.Outlined.WarningAmber" Color="Color.Error" Size="Size.Small" Class="mx-2" Title="Action required" />
                            break;
                        case VerificationStatus.Submitted:
                            <MudIcon Icon="@Icons.Outlined.FactCheck" Color="Color.Surface" Size="Size.Small" Class="mx-2" Title="Under review" />
                            break;
                        case VerificationStatus.Verified:
                            @if (!_isVerified)
                            {
                                <MudIcon Icon="@Icons.Outlined.CheckCircle" Style="@($"color:{Colors.Green.Lighten3}")" Size="Size.Small" Class="mx-2" Title="Verified" />
                            }
                            break;
                    }
                </MudNavLink>
            </MudNavGroup>
        }

        @* normal users - Loans *@
        @if (_canViewLoans && !CanViewAdministrationGroup)
        {
            @if (_canViewLoans)
            {
                @if (AppDataService.AppUser.RoleName != default)
                {
                    @* <MudText Typo="Typo.subtitle2" Color="Color.Primary" Class="ml-4 my-3">@L["Loans"]</MudText> *@
                    <MudNavGroup Title="@L["Loans"]" Expanded Icon="@Icons.TwoTone.ConnectWithoutContact" ExpandIcon="@Icons.Filled.KeyboardArrowDown">

                        @if (AppDataService.AppUser.RoleName.Equals("Lender") == true)
                        {
                            @* OnClick="@(() => Navigation.NavigateTo("/loans/lender", false))" *@
                            <MudNavLink Match="NavLinkMatch.All" ForceLoad=false Href="/loans/lender" Icon="@Icons.TwoTone.Handshake" Class="custom-nav-child">
                                @L["Loans"]
                            </MudNavLink>
                            @* OnClick="@(() => Navigation.NavigateTo("/loans/lender?history=true", false))"  *@
                            <MudNavLink Match="NavLinkMatch.All" ForceLoad=true Href="/loans/lender?history=true" Icon="@Icons.TwoTone.History" Class="custom-nav-child">
                                @L["History"]
                            </MudNavLink>
                        }
                        else
                       if (AppDataService.AppUser.RoleName.Equals("Lessee") == true)
                        {
                            @* OnClick="@(() => Navigation.NavigateTo("/loans/lender", false))" *@
                            <MudNavLink Match="NavLinkMatch.All" ForceLoad=false Href="/loans/lessee" Icon="@Icons.TwoTone.Handshake" Class="custom-nav-child">
                                @L["Loans"]
                            </MudNavLink>
                            @* OnClick="@(() => Navigation.NavigateTo("/loans/lender?history=true", false))"  *@
                            <MudNavLink Match="NavLinkMatch.All" ForceLoad=true Href="/loans/lessee?history=true" Icon="@Icons.TwoTone.History" Class="custom-nav-child">
                                @L["History"]
                            </MudNavLink>
                        }

                    </MudNavGroup>
                }

            }
        }

        @* normal users - TODO:// can only do things if verified *@
        @if (AppDataService.AppUser.IsVerified != default && !CanViewAdministrationGroup)
        {
            if (!string.IsNullOrEmpty(AppDataService.AppUser.RoleName) && AppDataService.AppUser.RoleName.Equals("Lender") == true)
            {
                if (_canViewAppUserProducts || _canViewBrands || _canViewCategories)
                {
                    @* <MudText Typo="Typo.subtitle2" Color="Color.Primary" Class="ml-4 my-3">@L["Dependency"]</MudText> *@
                    <MudNavGroup Title="@L["Dependencies"]" Expanded Icon="@Icons.TwoTone.Storefront" ExpandIcon="@Icons.Filled.KeyboardArrowDown">
                        @if (_canViewAppUserProducts)
                        {
                            <MudNavLink Match="NavLinkMatch.All" Href="/catalog/userproducts" Icon="@Icons.TwoTone.Engineering" Class="custom-nav-child">
                                @L["Products"]
                            </MudNavLink>
                        }
                        @if (_canViewBrands)
                        {
                            <MudNavLink Match="NavLinkMatch.All" Href="/catalog/brands" Icon="@Icons.TwoTone.Discount" Class="custom-nav-child">
                                @L["Brands"]
                            </MudNavLink>
                        }
                        @if (_canViewCategories)
                        {
                            <MudNavLink Match="NavLinkMatch.All" Href="/catalog/categories" Icon="@Icons.TwoTone.Category" Class="custom-nav-child">
                                @L["Categories"]
                            </MudNavLink>
                        }
                    </MudNavGroup>
                }

            }

            if (_canViewPackages)
            {
                @* <MudText Typo="Typo.subtitle2" Color="Color.Primary" Class="ml-4 my-3">@L["Dependency"]</MudText> *@
                <MudNavGroup Title="@L["Extras"]" Expanded Icon="@Icons.Filled.Settings" ExpandIcon="@Icons.Filled.KeyboardArrowDown">
                    @if (_canViewPackages)
                    {
                        <MudNavLink Match="NavLinkMatch.All" Href="/catalog/packages" Icon="@Icons.Outlined.Inventory2" Class="custom-nav-child">
                            @L["Packages"]
                        </MudNavLink>
                    }
                </MudNavGroup>
            }

        }
        else
        {
            <MudAlert Severity="Severity.Info">
                Features will be unlocked once verification process is satisfied.
            </MudAlert>
        }


    </MudNavMenu>
}